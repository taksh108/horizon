{% doc %}
  Grid Image block: an image with an optional overlay containing rich text and an outline button.

  @example
  {% content_for 'block', type: 'grid-image', id: 'promo-arizona' %}
{% enddoc %}

<div
  class="grid-image"
  style="
    {% if block.settings.rounded > 0 %}
      --grid-image-radius: {{ block.settings.rounded }}px;
    {% endif %}
  "
  {{ block.shopify_attributes }}
>
  <div class="grid-image__media">
    {% if block.settings.image != blank %}
      {% liquid
        assign img = block.settings.image
        assign height = img.width | divided_by: img.aspect_ratio | round
        assign widths = '640, 960, 1280, 1600, 1920, 2560, 3840'
        assign sizes = '(min-width: 750px) 33vw, 100vw'
        assign alt_text = block.settings.alt | default: block.settings.heading | strip_html | escape
      %}
      {{
        img
        | image_url: width: 3840
        | image_tag:
          widths: widths,
          height: height,
          sizes: sizes,
          alt: alt_text,
          loading: 'lazy',
          class: 'grid-image__img'
      }}
    {% else %}
      {{ 'image' | placeholder_svg_tag: 'grid-image__img grid-image__img--placeholder' }}
    {% endif %}

    {% if block.settings.show_overlay %}
      <div
        class="grid-image__overlay"
        style="
          {% if block.settings.overlay_color != blank %}
            background: {{ block.settings.overlay_color }};
          {% endif %}
        "
        aria-hidden="true"
      ></div>
    {% endif %}

    {% liquid
      assign has_content = false
      if block.settings.heading != blank or block.settings.subtext != blank or block.settings.button_label != blank
        assign has_content = true
      endif
    %}
    {% if has_content %}
      <div
        class="grid-image__content grid-image__content--h-{{ block.settings.horizontal_align }} grid-image__content--v-{{ block.settings.vertical_align }}"
        style="
          {% if block.settings.text_color != blank %}
            --grid-image-text: {{ block.settings.text_color }};
          {% endif %}
          {% if block.settings.content_padding > 0 %}
            --grid-image-content-padding: {{ block.settings.content_padding }}px;
          {% endif %}
        "
      >
        {% if block.settings.heading != blank %}
          <div class="grid-image__heading">{{ block.settings.heading }}</div>
        {% endif %}
        {% if block.settings.subtext != blank %}
          <div class="grid-image__subtext">{{ block.settings.subtext }}</div>
        {% endif %}
        {% if block.settings.button_label != blank %}
          <a
            class="grid-image__button grid-image__button--outline"
            href="{{ block.settings.button_link | default: '#' }}"
            aria-label="{{ block.settings.button_aria_label | default: block.settings.button_label | escape }}"
          >
            {{ block.settings.button_label | escape }}
          </a>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>

{% stylesheet %}
  .grid-image {
    position: relative;
  }

  .grid-image__media {
    position: relative;
    border-radius: var(--grid-image-radius, 12px);
    overflow: hidden;
  }

  .grid-image__img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .grid-image__overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.35);
    pointer-events: none;
  }

  .grid-image__content {
    position: absolute;
    inset: 0;
    display: grid;
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
    padding: var(--grid-image-content-padding, 16px);
    color: var(--grid-image-text, #ffffff);
  }

  /* Horizontal alignment */
  .grid-image__content--h-left { justify-items: start; text-align: left; }
  .grid-image__content--h-center { justify-items: center; text-align: center; }
  .grid-image__content--h-right { justify-items: end; text-align: right; }

  /* Vertical alignment */
  .grid-image__content--v-top { align-items: start; }
  .grid-image__content--v-center { align-items: center; }
  .grid-image__content--v-bottom { align-items: end; }

  .grid-image__heading :where(h1,h2,h3,h4,h5,h6,p,span) {
    margin: 0 0 6px 0;
    color: inherit;
  }

  .grid-image__subtext { margin: 0 0 12px 0; }

  .grid-image__button {
    display: inline-block;
    padding: 10px 16px;
    border-radius: 9999px;
    font-weight: 600;
    text-decoration: none;
    line-height: 1;
  }

  .grid-image__button--outline {
    background: transparent;
    color: var(--grid-image-text, #ffffff);
    border: 2px solid currentColor;
  }

  .grid-image__button--outline:hover {
    background: color-mix(in srgb, currentColor 12%, transparent);
  }

  .grid-image__button:focus-visible {
    outline: 3px solid #0056b3;
    outline-offset: 2px;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Grid Image",
  "tag": null,
  "settings": [
    { "type": "image_picker", "id": "image", "label": "Image" },
    { "type": "text", "id": "alt", "label": "Alt text", "info": "Describe the image for accessibility" },
    { "type": "checkbox", "id": "show_overlay", "label": "Show color overlay", "default": true },
    { "type": "color", "id": "overlay_color", "label": "Overlay color", "alpha": true, "default": "#00000059", "visible_if": "{{ block.settings.show_overlay }}" },

    { "type": "header", "content": "Content" },
    { "type": "richtext", "id": "heading", "label": "Heading", "default": "<p>Arizona</p>" },
    { "type": "richtext", "id": "subtext", "label": "Subtext", "default": "<p>Dates</p>" },
    { "type": "color", "id": "text_color", "label": "Text color", "default": "#ffffff" },
    { "type": "range", "id": "content_padding", "label": "Content padding", "min": 0, "max": 64, "step": 2, "unit": "px", "default": 16 },

    { "type": "header", "content": "Button" },
    { "type": "text", "id": "button_label", "label": "Label", "default": "Go to Event" },
    { "type": "url", "id": "button_link", "label": "Link" },
    { "type": "text", "id": "button_aria_label", "label": "ARIA label (optional)", "info": "Improves screen reader context" },

    { "type": "header", "content": "Alignment" },
    { "type": "select", "id": "horizontal_align", "label": "Horizontal", "options": [
      { "value": "left", "label": "Left" },
      { "value": "center", "label": "Center" },
      { "value": "right", "label": "Right" }
    ], "default": "center" },
    { "type": "select", "id": "vertical_align", "label": "Vertical", "options": [
      { "value": "top", "label": "Top" },
      { "value": "center", "label": "Center" },
      { "value": "bottom", "label": "Bottom" }
    ], "default": "bottom" },

    { "type": "header", "content": "Appearance" },
    { "type": "range", "id": "rounded", "label": "Corner radius", "min": 0, "max": 32, "step": 1, "unit": "px", "default": 12 }
  ],
  "presets": [
    {
      "name": "Grid Image",
      "category": "Media",
      "settings": {
        "show_overlay": true,
        "overlay_color": "#00000059",
        "horizontal_align": "center",
        "vertical_align": "bottom",
        "text_color": "#ffffff",
        "button_label": "Go to Event"
      }
    }
  ]
}
{% endschema %}


